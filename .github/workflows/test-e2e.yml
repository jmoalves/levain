name: Test - e2e

on:
  workflow_dispatch:

jobs:
  test-win:
    runs-on: windows-latest
    timeout-minutes: 30

    steps:
      - name: Download latest release
        run: |
          iwr https://github.com/jmoalves/levain/releases/latest/download/install.ps1 | iex
          # Add levain to PATH
          $LevainDir=[Environment]::GetEnvironmentVariable("HOME", "User") + "\" + "levain"
          Write-Output "Levain at $LevainDir"
          if (Test-Path $LevainDir) {
            $Path = $LevainDir + "levain"
            $Path = [Environment]::GetEnvironmentVariable("PATH", "User") + [IO.Path]::PathSeparator + $Path
            [Environment]::SetEnvironmentVariable( "Path", $Path, "User" )
          }

      - name: Run levain
        shell: cmd
        run: |
          call levain
